<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word to Word Converter</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <style>
        body { font-family: -apple-system, sans-serif; padding: 20px; background: #f2f2f7; text-align: center; }
        .box { background: white; max-width: 500px; margin: 30px auto; padding: 30px; border-radius: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        
        h2 { color: #1c1c1e; margin-bottom: 5px; }
        p { color: #8e8e93; font-size: 14px; margin-bottom: 25px; }

        .upload-btn {
            display: flex; align-items: center; justify-content: center;
            height: 120px; border: 2px dashed #007aff; background: #eef7ff;
            color: #007aff; border-radius: 15px; font-weight: 600; cursor: pointer;
            margin-bottom: 20px; transition: 0.2s;
        }
        .upload-btn:active { background: #dcebff; }
        
        input[type="file"] { display: none; }

        button {
            background: #007aff; color: white; border: none; padding: 18px; width: 100%;
            border-radius: 12px; font-size: 18px; font-weight: 600; cursor: pointer;
        }
        button:disabled { background: #d1d1d6; color: #8e8e93; cursor: not-allowed; }

        #fileName { font-weight: 500; color: #333; margin-bottom: 20px; display: none; }
    </style>
</head>
<body>

    <div class="box">
        <h2>Word to Word Converter</h2>
        <p>ShreeLipi to Unicode (Format Tasach Rahil)</p>
        
        <label for="fileInput" class="upload-btn">
            üìÇ Tap here to Select Word File
        </label>
        <input type="file" id="fileInput" accept=".docx,application/vnd.openxmlformats-officedocument.wordprocessingml.document">
        
        <div id="fileName"></div>

        <button id="convertBtn" disabled>Convert File</button>
    </div>

    <script>
        const fileInput = document.getElementById('fileInput');
        const fileNameDisplay = document.getElementById('fileName');
        const convertBtn = document.getElementById('convertBtn');

        // 1. File Selection
        fileInput.addEventListener('change', function() {
            if (this.files && this.files.length > 0) {
                fileNameDisplay.style.display = 'block';
                fileNameDisplay.innerText = "Selected: " + this.files[0].name;
                convertBtn.disabled = false;
                convertBtn.innerText = "Convert File";
            }
        });

        // 2. Logic: ShreeLipi to Unicode (Exact Logic)
        const shree = ['u','¬™','}','n','p','H','¬∑','I','¬ª','J','¬Ω','K','M','√Ä','N','¬µO','O','¬µ√Å','√Å','P','Q','R','¬∂S','S','¬∂T','T','U','√ä','W','√è','V','√ã','Y','√ú','X','Z','√ù','\\','√¢','[','√ü','^','√§',']','√£','_','√•','`','a','c','√´','d','√¨','e','√ª','√≠','f','√Æ','g','√±','h','j','√∫','k','√î','√õ','√ö','√†','√û','Q¬≠','¬∫$','√å','√ê','√ï','l','√ém','¬∏','‚Äû','ÀÜ','≈ì','√Ö','Am¬°','Am{','Am|','Am','A','B¬©','B','C','D','E{','E','F','m¬∞','m{','m|','{','|','m¬°','m¬¢','¬°','¬¢','m','r','s','t','w','√æ','y','¬ß','¬±','‚Ä¢','¬•','¬≤','√ë','¬´','√©','√™','&','$','>','¬µ'];
        const uni = ['¬©','¬©‡§Ç','{¬©','o','o',"‡§ï",'‡§ï‡•ç‚Äå',"‡§ñ",'‡§ñ‡•ç‚Äå',"‡§ó",'‡§ó‡•ç',"‡§ò",'‡§ö','‡§ö‡•ç‚Äå','‡§õ','‡§ú‡§º','‡§ú','‡§ú‡§º‡•ç‚Äå','‡§ú‡•ç‚Äå','‡§ù',"‡§ü","‡§†",'‡§°‡§º',"‡§°",'‡§¢‡§º','‡§¢',"‡§£",'‡§£‡•ç',"‡§•",'‡§•‡•ç',"‡§§",'‡§§‡•ç',"‡§ß",'‡§ß‡•ç',"‡§¶","‡§®",'‡§®‡•ç',"‡§´",'‡§´‡•ç‚Äå',"‡§™",'‡§™‡•ç‚Äå',"‡§≠",'‡§≠‡•ç',"‡§¨",'‡§¨‡•ç‚Äå',"‡§Æ",'‡§Æ‡•ç',"‡§Ø","‡§∞","‡§≤",'‡§≤‡•ç‚Äå',"‡§µ",'‡§µ‡•ç‚Äå',"‡§∂",'‡§∂‡•ç','‡§∂‡•ç',"‡§∑",'‡§∑‡•ç‚Äå',"‡§∏",'‡§∏‡•ç',"‡§π",'‡§ï‡•ç‡§∑','‡§ï‡•ç‡§∑‡•ç','‡§ú‡•ç‡§û','‡§¶‡•ç‡§¶','‡§¶‡•ç‡§µ','‡§¶‡•ç‡§Ø','‡§™‡•ç‡§∞','‡§®‡•ç‡§®','‡§ü‡•ç‡§∞','‡§ï‡•ç‡§§','‡§§‡•ç‡§∞','‡§¶‡•ç‡§∞','‡§¶‡•ç‡§ß','‡§∂‡•ç‡§∞','‡§§‡•ç‡§§','‡§ï‡•ç‡§ï','‡§≤‡•ç‡§≤','‡§π‡•ç‡§µ','‡§∂‡•ç‡§µ','‡§ü‡•ç‡§ü','‡§î','‡§ì','‡§ì‡§Ç','‡§Ü','‡§Ö','‡§à','‡§á','‡§â','‡§ä','‡§ê','‡§è','‡§ã','‡•â',"‡•ã","‡•ã‡§Ç","‡•á","‡•á‡§Ç","‡•å","‡•å‡§Ç","‡•à",'‡•à‡§Ç',"‡§æ","‡•Ä","‡•Ä","‡•Ä‡§Ç","‡•Å",'‡•Å',"‡•Ç",'‡§Ç','‡§Å','‡§É','‡•É','‡•ç‚Äå','‡§¶‡•É','‡•ç‡§∞','‡§∞‡•Å','‡§∞‡•Ç','‡•§','','',''];

        function convertString(txt) {
            if (!txt) return "";
            let res = txt;
            
            // Basic Replacement
            for(let i=0; i<shree.length; i++) {
                if(shree[i] && uni[i]) res = res.split(shree[i]).join(uni[i]);
            }

            // Fixes (Velaanti & Rafar)
            while(res.includes("o")) {
                let idx = res.indexOf("o");
                if(idx < res.length-1) {
                    let next = res.charAt(idx+1);
                    res = res.substring(0, idx) + next + "‡§ø" + res.substring(idx+2);
                } else { res = res.replace("o", "‡§ø‡§Ç"); }
            }
            res = res.replace(/o/g, "‡§ø‡§Ç");
            
            const matras = "‡§æ‡§ø‡•Ä‡•Å‡•Ç‡•É‡•á‡•à‡•ã‡•å‡§Ç‡§É‡§Å‡•Ö";
            let rIdx = res.indexOf("¬©");
            while(rIdx > 0) {
                let p = rIdx - 1;
                while(p >= 0 && matras.includes(res.charAt(p))) p--;
                if(p < 0) p = 0;
                let chunk = res.substring(p, rIdx);
                res = res.substring(0, p) + "‡§∞‡•ç" + chunk + res.substring(rIdx+1);
                rIdx = res.indexOf("¬©", p + chunk.length + 2);
            }
            return res;
        }

        // 3. Main Process: Docx Structure Modifying
        convertBtn.addEventListener('click', async () => {
            if (!fileInput.files.length) return;
            
            convertBtn.disabled = true;
            convertBtn.innerText = "Processing...";
            
            try {
                if (typeof JSZip === 'undefined') throw new Error("Internet is needed. Please connect.");

                const file = fileInput.files[0];
                const data = await file.arrayBuffer();
                const zip = await JSZip.loadAsync(data);
                
                // document.xml (Main Content)
                if (zip.file("word/document.xml")) {
                    const docXml = await zip.file("word/document.xml").async("string");
                    const parser = new DOMParser();
                    const xmlDoc = parser.parseFromString(docXml, "text/xml");
                    const textNodes = xmlDoc.getElementsByTagName("w:t"); // Fakt Text Nodes

                    for (let i = 0; i < textNodes.length; i++) {
                        let original = textNodes[i].textContent;
                        if(original && original.trim().length > 0) {
                            textNodes[i].textContent = convertString(original);
                        }
                    }

                    const serializer = new XMLSerializer();
                    const newXml = serializer.serializeToString(xmlDoc);
                    zip.file("word/document.xml", newXml);
                }

                // Headers/Footers (Optional: Jar header madhe pan shreelipi asel tar)
                zip.forEach(async (relativePath, zipEntry) => {
                    if (relativePath.startsWith("word/header") || relativePath.startsWith("word/footer")) {
                        const xml = await zipEntry.async("string");
                        // Future improvement: Process headers same as body
                    }
                });

                // Generate new Docx
                const blob = await zip.generateAsync({
                    type: "blob",
                    mimeType: "application/vnd.openxmlformats-officedocument.wordprocessingml.document"
                });

                // Download
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = "Converted_" + file.name; // Name same, just prefix
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);

                convertBtn.innerText = "Done! Open File";
                setTimeout(() => convertBtn.disabled = false, 2000);

            } catch (err) {
                alert("Error: " + err.message);
                convertBtn.innerText = "Try Again";
                convertBtn.disabled = false;
            }
        });
    </script>
</body>
</html>
